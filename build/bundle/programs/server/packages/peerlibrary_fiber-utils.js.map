{"version":3,"sources":["meteor://ðŸ’»app/packages/peerlibrary_fiber-utils/packages/peerlibrary_fiber-utils.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"/packages/peerlibrary_fiber-utils.js","sourcesContent":["(function () {\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                    //\n// packages/peerlibrary:fiber-utils/base.coffee.js                                                    //\n//                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                      //\n__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\n               \n\nFiberUtils = (function() {\n  function FiberUtils() {}\n\n  return FiberUtils;\n\n})();\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                    //\n// packages/peerlibrary:fiber-utils/fence.coffee.js                                                   //\n//                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                      //\n__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar Fiber, Future,\n  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nFiber = Npm.require('fibers');\n\nFuture = Npm.require('fibers/future');\n\nFiberUtils.OrderedFence = (function() {\n  function OrderedFence(_arg) {\n    this.allowRecursive = _arg.allowRecursive, this.allowNested = _arg.allowNested, this.breakDeadlocks = _arg.breakDeadlocks;\n    if (this.allowRecursive == null) {\n      this.allowRecursive = true;\n    }\n    if (this.allowNested == null) {\n      this.allowNested = true;\n    }\n    if (this.breakDeadlocks == null) {\n      this.breakDeadlocks = true;\n    }\n    this._futures = [];\n    this._currentFiber = null;\n  }\n\n  OrderedFence.prototype.enter = function() {\n    var dependedFiber, future, node, ownFuture, queue, visited, _base, _base1;\n    if (Fiber.current === this._currentFiber) {\n      if (!this.allowRecursive) {\n        throw new Error(\"Recursive reentry of guarded section within the same fiber not allowed.\");\n      }\n      return false;\n    }\n    if (Fiber.current._guardsActive > 0 && !this.allowNested) {\n      throw new Error(\"Nesting of guarded sections is not allowed.\");\n    }\n    dependedFiber = null;\n    if (this._currentFiber) {\n      if ((_base = Fiber.current)._dependencies == null) {\n        _base._dependencies = [];\n      }\n      Fiber.current._dependencies.push(this._currentFiber);\n      dependedFiber = this._currentFiber;\n      visited = [];\n      queue = [Fiber.current];\n      while (true) {\n        node = queue.shift();\n        if (!node) {\n          break;\n        }\n        if (__indexOf.call(visited, node) >= 0) {\n          if (this.breakDeadlocks) {\n            Fiber.current._dependencies = _.without(Fiber.current._dependencies, this._currentFiber);\n            throw new Error(\"Dependency cycle detected between guarded sections.\");\n          }\n          console.warn(\"Dependency cycle detected between guarded sections. Deadlock not broken.\");\n          break;\n        }\n        visited.push(node);\n        queue = queue.concat(node._dependencies);\n      }\n      queue = null;\n      visited = null;\n    }\n    future = null;\n    if (!_.isEmpty(this._futures)) {\n      future = this._futures[this._futures.length - 1];\n    }\n    ownFuture = new Future();\n    this._futures.push(ownFuture);\n    if (future != null) {\n      future.wait();\n    }\n    if (dependedFiber) {\n      Fiber.current._dependencies = _.without(Fiber.current._dependencies, dependedFiber);\n    }\n    assert(this._futures[0] === ownFuture);\n    assert(!this._currentFiber);\n    this._currentFiber = Fiber.current;\n    if ((_base1 = this._currentFiber)._guardsActive == null) {\n      _base1._guardsActive = 0;\n    }\n    this._currentFiber._guardsActive++;\n    return true;\n  };\n\n  OrderedFence.prototype.exit = function(topLevel) {\n    var _ref;\n    if (!topLevel) {\n      return;\n    }\n    assert(this._currentFiber._guardsActive > 0);\n    this._currentFiber._guardsActive--;\n    this._currentFiber = null;\n    return (_ref = this._futures.shift()) != null ? _ref[\"return\"]() : void 0;\n  };\n\n  return OrderedFence;\n\n})();\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                    //\n// packages/peerlibrary:fiber-utils/synchronize.coffee.js                                             //\n//                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                      //\n__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nFiberUtils.synchronize = function(guardObject, uniqueId, body, options) {\n  var guards, topLevel;\n  if (options == null) {\n    options = {};\n  }\n  guards = guardObject._guards != null ? guardObject._guards : guardObject._guards = {};\n  if (guards[uniqueId] == null) {\n    guards[uniqueId] = new FiberUtils.OrderedFence(options);\n  }\n  topLevel = guards[uniqueId].enter();\n  try {\n    return body();\n  } finally {\n    guards[uniqueId].exit(topLevel);\n  }\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                    //\n// packages/peerlibrary:fiber-utils/ensure.coffee.js                                                  //\n//                                                                                                    //\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                      //\n__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar Fiber;\n\nFiber = Npm.require('fibers');\n\nFiberUtils.ensureFiber = function(func) {\n  if (Fiber.current) {\n    func();\n  } else {\n    new Fiber(func).run();\n  }\n};\n////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}